# Droppy 4.7.5 - Memory & Performance Optimization

## ðŸš€ Major Performance Improvements

### Memory Usage (Up to 95% Reduction)
- **Disk-based image storage**: Clipboard images are now stored on disk instead of in RAM
  - Before: All images loaded in memory (~2-3GB with 50+ images)
  - After: Only thumbnails loaded on-demand (~100-250MB typical)
- **Automatic migration**: Existing clipboard entries are automatically migrated on first launch
- **No data loss**: All existing clipboard history is preserved

### CPU Optimization (Smoother Scrolling)
- **Async thumbnail loading**: Thumbnails now load in background threads, eliminating scroll lag
- **Cached sorted history**: Filter/sort operations now run only when data changes, not on every frame
- **Reduced main thread blocking**: Image decoding moved off the main thread

## ðŸ”§ Technical Improvements

### Clipboard System
- New `ThumbnailCache` system using NSCache for efficient memory management
- Image files stored in `~/Library/Application Support/Droppy/images/`
- Automatic cleanup when items are deleted or history limit is reached
- Image compression for new entries (JPEG 80% quality, max 1MB)

### Link Preview Service
- Converted Dictionary caches to NSCache with automatic eviction
- Limits: 50 metadata entries, 30 images (auto-evicts under memory pressure)

### Brightness Manager
- Increased polling interval from 250ms to 500ms
- Added mutex to prevent XPC race conditions and crashes

## ðŸ“‹ What's Changed
- Added: `ThumbnailCache.swift` - New thumbnail caching system
- Modified: `ClipboardManager.swift` - Disk-based image storage & migration
- Modified: `ClipboardManagerView.swift` - Async thumbnails & cached sorted history
- Modified: `LinkPreviewService.swift` - NSCache for memory efficiency
- Modified: `BrightnessManager.swift` - Improved polling stability
